# 前后端联调测试指南

## ✅ 已完成的工作

### 1. 创建了API客户端
- 文件：`前端/utils/api_client.py`
- 功能：封装了所有Django后端API调用

### 2. 替换了Mock数据
已将以下页面的Mock数据替换为真实API调用：

- ✅ **用户认证** (`前端/用户认证/auth.py`)
  - 登录功能：调用 `/api/v1/users/login/`
  - 注册功能：调用 `/api/v1/users/register/`

- ✅ **课程中心** (`前端/核心页面UI/课程中心.py`)
  - 课程列表：调用 `/api/v1/courses/courses/`
  - 支持按学科和年级筛选

- ✅ **课程详情** (`前端/核心页面UI/课程详情.py`)
  - 课程详情：调用 `/api/v1/courses/courses/{id}/`
  - 知识点总结：调用 `/api/v1/courses/courses/{id}/generate-summary/`

- ✅ **智能练习** (`前端/核心页面UI/智能练习.py`)
  - 练习题生成：调用 `/api/v1/exercises/generate/`

---

## 🚀 测试步骤

### 第一步：启动Django后端

```bash
# 进入后端目录
cd study

# 确保虚拟环境已激活
# Windows:
venv\Scripts\activate

# 启动Django服务器
python manage.py runserver 0.0.0.0:8000
```

**验证后端启动成功：**
- 访问：http://localhost:8000/admin/
- 应该能看到Django Admin登录页面

---

### 第二步：启动Streamlit前端

**打开新的终端窗口：**

```bash
# 进入前端目录
cd 前端

# 启动Streamlit
streamlit run app.py
```

**验证前端启动成功：**
- 浏览器自动打开：http://localhost:8501
- 应该能看到登录页面

---

### 第三步：测试用户注册

1. 在登录页面切换到"注册"标签页
2. 填写注册信息：
   - 用户名：`test_student`
   - 邮箱：`test@example.com`
   - 密码：`Test123456`
   - 确认密码：`Test123456`
   - 年级：选择"初一"
3. 点击"注册"按钮

**预期结果：**
- ✅ 显示"注册成功！请使用新账号登录"
- ✅ 在Django Admin后台可以看到新用户

**如果失败：**
- ❌ 检查Django后端是否正常运行
- ❌ 查看终端错误信息
- ❌ 检查数据库连接是否正常

---

### 第四步：测试用户登录

1. 切换到"登录"标签页
2. 输入刚才注册的账号：
   - 用户名：`test_student`
   - 密码：`Test123456`
3. 点击"登录"按钮

**预期结果：**
- ✅ 登录成功，跳转到首页
- ✅ 显示"欢迎回来，test_student！"
- ✅ 可以看到三个学科卡片

**如果失败：**
- ❌ 检查用户名密码是否正确
- ❌ 查看Django终端是否有错误日志
- ❌ 检查JWT认证配置

---

### 第五步：测试课程列表

1. 点击"📚 语文"按钮
2. 选择学科和年级

**预期结果：**
- ✅ 显示"正在加载课程列表..."
- ✅ 如果有课程数据，显示课程列表
- ⚠️ 如果没有课程，显示"该学科暂无课程数据"

**如果没有课程数据：**
需要在Django Admin后台添加课程：
1. 访问：http://localhost:8000/admin/
2. 登录（用户名：admin，密码：你设置的密码）
3. 进入"课程管理" > "课程"
4. 点击"添加课程"
5. 填写课程信息并保存

---

### 第六步：测试课程详情

1. 在课程列表中点击"📖 查看详情"

**预期结果：**
- ✅ 显示课程标题、学科、年级、难度
- ✅ 显示课程大纲
- ✅ 显示关键词标签

---

### 第七步：测试AI功能（需要API Key）

#### 7.1 配置AI API Key

1. 点击"👤 个人中心"
2. 在"AI API Key配置"区域：
   - 选择AI模型：DeepSeek-R1
   - 输入API Key：你的DeepSeek API Key
   - 点击"💾 保存配置"

**获取DeepSeek API Key：**
- 访问：https://platform.deepseek.com/
- 注册并获取API Key

#### 7.2 测试知识点总结

1. 返回课程详情页面
2. 点击"🤖 查看/生成知识点总结"

**预期结果：**
- ✅ 显示"正在生成知识点总结，请稍候..."
- ✅ 30-60秒后显示AI生成的知识点总结
- ✅ 内容包含课文主旨、作者介绍、重点字词等

**如果失败：**
- ❌ 检查API Key是否正确
- ❌ 检查Prompt模板是否已导入
- ❌ 查看Django终端错误日志

#### 7.3 测试练习题生成

1. 点击"🤖 开始智能练习"
2. 点击"🤖 开始生成练习题"

**预期结果：**
- ✅ 显示"AI正在生成练习题，请稍候（可能需要30-60秒）..."
- ✅ 生成25道练习题
- ✅ 可以浏览和作答题目

---

## 🐛 常见问题排查

### 问题1：前端无法连接后端

**症状：**
- 登录时显示"登录失败: Connection refused"
- 课程列表显示"加载课程失败"

**解决方法：**
1. 检查Django是否正常运行：`http://localhost:8000/admin/`
2. 检查防火墙是否阻止了8000端口
3. 检查API客户端的base_url配置

---

### 问题2：登录失败

**症状：**
- 显示"用户名或密码错误"

**解决方法：**
1. 确认用户已注册
2. 在Django Admin后台检查用户是否存在
3. 检查密码是否正确（区分大小写）

---

### 问题3：课程列表为空

**症状：**
- 显示"该学科暂无课程数据"

**解决方法：**
1. 在Django Admin后台添加课程数据
2. 或运行课程导入脚本（如果有）
3. 检查学科和年级筛选条件是否正确

---

### 问题4：AI功能失败

**症状：**
- 知识点总结生成失败
- 练习题生成失败

**解决方法：**
1. 检查是否已配置AI API Key
2. 检查API Key是否有效
3. 检查Prompt模板是否已导入：
   ```bash
   cd study
   python init_prompt_templates.py
   ```
4. 检查DeepSeek API余额是否充足

---

## 📝 测试检查清单

- [ ] Django后端启动成功
- [ ] Streamlit前端启动成功
- [ ] 用户注册功能正常
- [ ] 用户登录功能正常
- [ ] 课程列表加载正常
- [ ] 课程详情显示正常
- [ ] AI API Key配置成功
- [ ] 知识点总结生成成功
- [ ] 练习题生成成功

---

## 🎉 测试成功标志

如果以上所有功能都正常工作，说明前后端联调成功！

**下一步工作：**
1. 导入完整的课程数据（135门课程）
2. 完善练习题批改功能
3. 添加学习进度跟踪
4. 优化PAD端体验
5. 进行真机测试

---

## 📞 需要帮助？

如果遇到问题，请检查：
1. Django终端的错误日志
2. Streamlit终端的错误信息
3. 浏览器控制台的网络请求
4. Django Admin后台的数据状态

**日志文件位置：**
- Django日志：`study/logs/django.log`
- Streamlit日志：终端输出
