<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">æ™ºèƒ½ç»ƒä¹ é¢˜ - ä¸Šæµ·åˆä¸­å­¦ä¹ ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            line-height: 1.6;
        }

        .navbar {
            background: white;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
            padding: 0 20px;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .navbar-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            max-width: 1200px;
            margin: 0 auto;
            height: 70px;
        }

        .navbar-brand {
            display: flex;
            align-items: center;
            font-size: 1.4rem;
            font-weight: 700;
            color: #2c3e50;
            text-decoration: none;
        }

        .exercise-info {
            display: flex;
            align-items: center;
            gap: 20px;
            font-size: 0.9rem;
        }

        .timer {
            background: #e74c3c;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-weight: 600;
        }

        .progress-info {
            color: #6c757d;
        }

        .main-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 30px;
        }

        .question-nav {
            background: white;
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            position: sticky;
            top: 90px;
            height: fit-content;
        }

        .nav-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
        }

        .question-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            margin-bottom: 20px;
        }

        .question-dot {
            width: 35px;
            height: 35px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.3s ease;
            border: 2px solid #e9ecef;
        }

        .question-dot.current {
            background: #667eea;
            color: white;
            border-color: #667eea;
            transform: scale(1.1);
        }

        .question-dot.answered {
            background: #27ae60;
            color: white;
            border-color: #27ae60;
        }

        .question-dot.unanswered {
            background: #f8f9fa;
            color: #6c757d;
        }

        .nav-legend {
            font-size: 0.8rem;
            color: #6c757d;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 3px;
        }

        .question-container {
            background: white;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            min-height: 600px;
            display: flex;
            flex-direction: column;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 25px;
        }

        .question-meta {
            display: flex;
            gap: 15px;
        }

        .meta-tag {
            padding: 5px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .type-tag {
            background: #3498db;
            color: white;
        }

        .difficulty-tag.basic {
            background: #27ae60;
            color: white;
        }

        .difficulty-tag.medium {
            background: #f39c12;
            color: white;
        }

        .difficulty-tag.advanced {
            background: #e74c3c;
            color: white;
        }

        .question-number {
            font-size: 1.2rem;
            font-weight: 700;
            color: #667eea;
        }

        .question-content {
            flex: 1;
        }

        .question-text {
            font-size: 1.1rem;
            line-height: 1.7;
            color: #2c3e50;
            margin-bottom: 30px;
        }

        .options-container {
            margin-bottom: 30px;
        }

        .option-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 15px;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .option-item:hover {
            background: #f8f9fa;
        }

        .option-item.selected {
            background: #e3f2fd;
            border-color: #2196f3;
        }

        .option-radio {
            width: 20px;
            height: 20px;
            border: 2px solid #dee2e6;
            border-radius: 50%;
            position: relative;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .option-radio.selected {
            border-color: #2196f3;
        }

        .option-radio.selected::after {
            content: '';
            position: absolute;
            top: 4px;
            left: 4px;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #2196f3;
        }

        .option-text {
            flex: 1;
            font-size: 1rem;
            line-height: 1.5;
        }

        .text-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1rem;
            resize: vertical;
            min-height: 100px;
            font-family: inherit;
        }

        .text-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .blank-input {
            display: inline-block;
            min-width: 100px;
            padding: 4px 12px;
            border: none;
            border-bottom: 2px solid #3498db;
            background: #e3f2fd;
            font-size: 1rem;
            font-family: inherit;
            text-align: center;
            margin: 0 3px;
            transition: all 0.3s ease;
        }

        .blank-input:focus {
            outline: none;
            border-bottom-color: #667eea;
            background: #fff;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
        }

        .question-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 20px;
            border-top: 1px solid #f1f3f4;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
        }

        .nav-button {
            padding: 12px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 0.95rem;
        }

        .prev-button {
            background: #f8f9fa;
            color: #6c757d;
        }

        .next-button {
            background: #667eea;
            color: white;
        }

        .nav-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .nav-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .submit-button {
            background: linear-gradient(45deg, #27ae60, #229954);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .submit-button:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(39, 174, 96, 0.4);
        }

        .back-to-index {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            color: #667eea;
            padding: 10px 15px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
            z-index: 101;
        }

        .back-to-index:hover {
            background: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        @media (max-width: 968px) {
            .main-content {
                grid-template-columns: 1fr;
                padding: 15px;
            }
            
            .question-nav {
                position: static;
                margin-bottom: 20px;
            }
            
            .question-container {
                padding: 25px 20px;
            }
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-to-index">â† è¿”å›é¦–é¡µ</a>
    
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="navbar-content">
            <a href="home.html" class="navbar-brand">
                ğŸ“
                <span>æ™ºèƒ½ç»ƒä¹ é¢˜</span>
            </a>
            
            <div class="exercise-info">
                <div class="timer" id="timer">45:00</div>
                <div class="progress-info">
                    <span id="current-question">1</span> / 25 é¢˜
                </div>
            </div>
        </div>
    </nav>

    <!-- ä¸»è¦å†…å®¹ -->
    <main class="main-content">
        <!-- é¢˜ç›®å¯¼èˆª -->
        <div class="question-nav">
            <h3 class="nav-title">é¢˜ç›®å¯¼èˆª</h3>
            <div class="question-grid" id="question-grid">
                <!-- é¢˜ç›®åœ†ç‚¹å°†é€šè¿‡JavaScriptç”Ÿæˆ -->
            </div>
            <div class="nav-legend">
                <div class="legend-item">
                    <div class="legend-dot" style="background: #667eea;"></div>
                    <span>å½“å‰é¢˜ç›®</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: #27ae60;"></div>
                    <span>å·²ä½œç­”</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: #f8f9fa; border: 1px solid #dee2e6;"></div>
                    <span>æœªä½œç­”</span>
                </div>
            </div>
        </div>

        <!-- é¢˜ç›®å†…å®¹ -->
        <div class="question-container">
            <div class="question-header">
                <div class="question-meta">
                    <span class="meta-tag type-tag" id="question-type">é€‰æ‹©é¢˜</span>
                    <span class="meta-tag difficulty-tag basic" id="question-difficulty">åŸºç¡€</span>
                </div>
                <div class="question-number">
                    ç¬¬ <span id="question-num">1</span> é¢˜
                </div>
            </div>

            <div class="question-content">
                <div class="question-text" id="question-text">
                    ä¸‹åˆ—å…³äºæ•£æ–‡ã€Šæ•£æ­¥ã€‹çš„ç†è§£ï¼Œæ­£ç¡®çš„æ˜¯ï¼š
                </div>

                <div class="options-container" id="options-container">
                    <!-- é€‰é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>

            <div class="question-actions">
                <div class="nav-buttons">
                    <button class="nav-button prev-button" onclick="prevQuestion()" id="prev-btn" disabled>
                        â† ä¸Šä¸€é¢˜
                    </button>
                    <button class="nav-button next-button" onclick="nextQuestion()" id="next-btn">
                        ä¸‹ä¸€é¢˜ â†’
                    </button>
                </div>

                <button class="submit-button" onclick="submitExercise()" id="submit-btn" style="display: none;">
                    æäº¤ç­”æ¡ˆ
                </button>
            </div>
        </div>
    </main>

    <script>
        // å½“å‰é¢˜ç›®ç´¢å¼•
        let currentQuestion = 0;
        let answers = new Array(25).fill(null);
        let timeRemaining = 45 * 60; // 45åˆ†é’Ÿ
        
        // æ ¹æ®å­¦ç§‘ç”Ÿæˆé¢˜ç›®æ•°æ®
        function generateQuestions(subject) {
            const questionBank = {
                chinese: [
                    {
                        type: 'é€‰æ‹©é¢˜',
                        difficulty: 'basic',
                        question: 'ä¸‹åˆ—å…³äºæ•£æ–‡ã€Šæ•£æ­¥ã€‹çš„ç†è§£ï¼Œæ­£ç¡®çš„æ˜¯ï¼š',
                        options: [
                            'A. æ–‡ç« ä»¥"æˆ‘"çš„è§†è§’ï¼Œå™è¿°äº†ä¸€å®¶ä¸‰ä»£äººæ•£æ­¥çš„æ¸©é¦¨åœºé¢',
                            'B. ä½œè€…é€šè¿‡æ•£æ­¥è¿™ä¸ªæ—¥å¸¸ç”Ÿæ´»ç‰‡æ®µï¼Œè¡¨è¾¾äº†å¯¹å®¶åº­è´£ä»»çš„æ€è€ƒ',
                            'C. æ–‡ç« ä½“ç°äº†ä¸­åæ°‘æ—å°Šè€çˆ±å¹¼çš„ä¼ ç»Ÿç¾å¾·',
                            'D. ä»¥ä¸Šè¯´æ³•éƒ½æ­£ç¡®'
                        ],
                        answer: 'D'
                    },
                    {
                        type: 'å¡«ç©ºé¢˜',
                        difficulty: 'medium',
                        question: 'ã€Šæ•£æ­¥ã€‹ä¸€æ–‡ä¸­ï¼Œå½“"æˆ‘"é¢å¯¹åˆ†æ­§æ—¶ï¼Œæœ€ç»ˆé€‰æ‹©äº†èµ°ï¼ˆã€€ã€€ï¼‰è·¯ï¼Œä½“ç°äº†ä½œè€…ï¼ˆã€€ã€€ï¼‰çš„å“è´¨ã€‚',
                        answer: 'å¤§è·¯ï¼›å°Šè€'
                    },
                    {
                        type: 'é€‰æ‹©é¢˜',
                        difficulty: 'basic',
                        question: 'ã€Šç§‹å¤©çš„æ€€å¿µã€‹ä¸­ï¼Œæ¯äº²è¯´"å’±å¨˜å„¿ä¿©åœ¨ä¸€å—å„¿ï¼Œå¥½å¥½å„¿æ´»"è¿™å¥è¯çš„å«ä¹‰æ˜¯ï¼š',
                        options: [
                            'A. è¡¨è¾¾äº†æ¯äº²å¯¹ç”Ÿæ´»çš„çƒ­çˆ±å’Œå¯¹å„¿å­çš„é¼“åŠ±',
                            'B. æ¯äº²å¸Œæœ›å’Œå„¿å­ä¸€èµ·é¢å¯¹å›°éš¾',
                            'C. æ¯äº²ç”¨æœ´å®çš„è¯è¯­ä¼ é€’ç€åšå¼ºçš„ç”Ÿæ´»ä¿¡å¿µ',
                            'D. ä»¥ä¸Šéƒ½æ­£ç¡®'
                        ],
                        answer: 'D'
                    }
                ],
                math: [
                    {
                        type: 'é€‰æ‹©é¢˜',
                        difficulty: 'basic',
                        question: 'è®¡ç®—ï¼š3x + 5 = 14ï¼Œåˆ™ x çš„å€¼æ˜¯ï¼š',
                        options: [
                            'A. x = 1',
                            'B. x = 2',
                            'C. x = 3',
                            'D. x = 4'
                        ],
                        answer: 'C'
                    },
                    {
                        type: 'å¡«ç©ºé¢˜',
                        difficulty: 'medium',
                        question: 'åŒ–ç®€ï¼š2(x + 3) - (x - 1) = ï¼ˆã€€ã€€ï¼‰',
                        answer: 'x + 7'
                    },
                    {
                        type: 'é€‰æ‹©é¢˜',
                        difficulty: 'medium',
                        question: 'ä¸‹åˆ—å“ªä¸ªæ˜¯æ–¹ç¨‹ 2x - 6 = 0 çš„è§£ï¼Ÿ',
                        options: [
                            'A. x = 1',
                            'B. x = 2',
                            'C. x = 3',
                            'D. x = 4'
                        ],
                        answer: 'C'
                    }
                ],
                english: [
                    {
                        type: 'é€‰æ‹©é¢˜',
                        difficulty: 'basic',
                        question: 'Choose the correct answer: This is _____ apple.',
                        options: [
                            'A. a',
                            'B. an',
                            'C. the',
                            'D. /'
                        ],
                        answer: 'B'
                    },
                    {
                        type: 'å¡«ç©ºé¢˜',
                        difficulty: 'medium',
                        question: 'What _____ your name? (å¡«å…¥æ­£ç¡®çš„beåŠ¨è¯)',
                        answer: 'is'
                    },
                    {
                        type: 'é€‰æ‹©é¢˜',
                        difficulty: 'basic',
                        question: 'Which sentence is correct?',
                        options: [
                            'A. He am a student.',
                            'B. He is a student.',
                            'C. He are a student.',
                            'D. He be a student.'
                        ],
                        answer: 'B'
                    }
                ]
            };
            
            return questionBank[subject] || questionBank.chinese;
        }
        
        // é¢˜ç›®æ•°æ®å°†åœ¨åˆå§‹åŒ–æ—¶æ ¹æ®å­¦ç§‘ç”Ÿæˆ
        let questions = [];

        // åˆå§‹åŒ–é¡µé¢
        function initializePage() {
            // æ›´æ–°é¡µé¢æ ‡é¢˜
            const { subject } = getUrlParams();
            const subjectNames = {
                chinese: 'è¯­æ–‡',
                math: 'æ•°å­¦',
                english: 'è‹±è¯­'
            };
            const subjectName = subjectNames[subject] || 'è¯­æ–‡';
            document.getElementById('page-title').textContent = `${subjectName}ç»ƒä¹ é¢˜ - ä¸Šæµ·åˆä¸­å­¦ä¹ ç³»ç»Ÿ`;
            
            // æ ¹æ®å­¦ç§‘ç”Ÿæˆé¢˜ç›®
            questions = generateQuestions(subject);
            
            renderQuestionNav();
            renderCurrentQuestion();
            startTimer();
        }

        // æ¸²æŸ“é¢˜ç›®å¯¼èˆª
        function renderQuestionNav() {
            const grid = document.getElementById('question-grid');
            grid.innerHTML = '';
            
            for (let i = 0; i < 25; i++) {
                const dot = document.createElement('div');
                dot.className = `question-dot ${i === currentQuestion ? 'current' : (answers[i] ? 'answered' : 'unanswered')}`;
                dot.textContent = i + 1;
                dot.onclick = () => goToQuestion(i);
                grid.appendChild(dot);
            }
        }

        // æ¸²æŸ“å½“å‰é¢˜ç›®
        function renderCurrentQuestion() {
            const questionData = questions[currentQuestion] || getDefaultQuestion();
            
            document.getElementById('question-num').textContent = currentQuestion + 1;
            document.getElementById('current-question').textContent = currentQuestion + 1;
            document.getElementById('question-type').textContent = questionData.type;
            document.getElementById('question-difficulty').textContent = getDifficultyText(questionData.difficulty);
            document.getElementById('question-difficulty').className = `meta-tag difficulty-tag ${questionData.difficulty}`;
            
            // å¤„ç†é¢˜ç›®æ–‡æœ¬
            if (questionData.type === 'å¡«ç©ºé¢˜') {
                // å°†æ‹¬å·æ›¿æ¢ä¸ºè¾“å…¥æ¡†
                const questionTextEl = document.getElementById('question-text');
                let questionHtml = questionData.question;
                
                // è·å–å½“å‰ç­”æ¡ˆï¼ˆå¯èƒ½æ˜¯å¤šä¸ªå¡«ç©ºçš„ç­”æ¡ˆï¼Œç”¨åˆ†å·åˆ†éš”ï¼‰
                const currentAnswers = answers[currentQuestion] ? answers[currentQuestion].split('ï¼›') : [];
                
                let blankIndex = 0;
                // åŒ¹é…æ‹¬å·ï¼šï¼ˆã€€ã€€ï¼‰æˆ–ï¼ˆ___ï¼‰æˆ–ï¼ˆï¼‰æˆ–è‹±æ–‡ä¸‹åˆ’çº¿_____ç­‰
                questionHtml = questionHtml.replace(/ï¼ˆ[ã€€_\s]*ï¼‰|_{3,}/g, function(match) {
                    const inputId = `blank-${currentQuestion}-${blankIndex}`;
                    const value = currentAnswers[blankIndex] || '';
                    blankIndex++;
                    return `<input type="text" class="blank-input" id="${inputId}" value="${value}" data-blank-index="${blankIndex - 1}" placeholder="___">`;
                });
                
                questionTextEl.innerHTML = questionHtml;
                
                // ä¸ºæ‰€æœ‰å¡«ç©ºè¾“å…¥æ¡†ç»‘å®šäº‹ä»¶
                questionTextEl.querySelectorAll('.blank-input').forEach(input => {
                    input.addEventListener('input', saveBlankAnswers);
                });
            } else {
                document.getElementById('question-text').innerHTML = questionData.question;
            }

            renderOptions(questionData);
            updateNavigationButtons();
            renderQuestionNav();
        }
        
        // ä¿å­˜å¡«ç©ºé¢˜ç­”æ¡ˆ
        function saveBlankAnswers() {
            const inputs = document.querySelectorAll('.blank-input');
            const answerArray = Array.from(inputs).map(input => input.value.trim());
            answers[currentQuestion] = answerArray.join('ï¼›');
            renderQuestionNav();
        }

        // è·å–URLå‚æ•°
        function getUrlParams() {
            const urlParams = new URLSearchParams(window.location.search);
            return {
                subject: urlParams.get('subject') || 'chinese',
                grade: urlParams.get('grade') || 'grade1',
                course: parseInt(urlParams.get('course')) || 1
            };
        }

        // è·å–é»˜è®¤é¢˜ç›®ï¼ˆç”¨äºæ¼”ç¤ºï¼‰
        function getDefaultQuestion() {
            const { subject } = getUrlParams();
            const types = ['é€‰æ‹©é¢˜', 'å¡«ç©ºé¢˜', 'ç®€ç­”é¢˜'];
            const difficulties = ['basic', 'medium', 'advanced'];
            
            // æ ¹æ®ä¸åŒå­¦ç§‘ç”Ÿæˆä¸åŒçš„ç¤ºä¾‹é¢˜ç›®
            const sampleQuestions = {
                chinese: [
                    'è¯·åˆ†ææœ¬è¯¾çš„ä¸»è¦æ€æƒ³å†…å®¹ã€‚',
                    'ä¸‹åˆ—è¡¨è¿°ä¸­ï¼Œæ­£ç¡®çš„æ˜¯ï¼š',
                    'è¯·æ¦‚æ‹¬æœ¬æ–‡çš„ä¸­å¿ƒæ€æƒ³ã€‚',
                    'æ–‡ä¸­è¿ç”¨äº†å“ªäº›ä¿®è¾æ‰‹æ³•ï¼Ÿ',
                    'ä½œè€…é€šè¿‡ï¼ˆã€€ã€€ï¼‰æ‰‹æ³•ï¼Œè¡¨è¾¾äº†ï¼ˆã€€ã€€ï¼‰çš„æƒ…æ„Ÿã€‚',
                    'è¯·è§£é‡Šä¸‹åˆ—è¯è¯­çš„å«ä¹‰ã€‚'
                ],
                math: [
                    'è®¡ç®—ï¼š3x + 5 = 14ï¼Œåˆ™ x = ï¼ˆã€€ã€€ï¼‰',
                    'ä¸‹åˆ—è®¡ç®—æ­£ç¡®çš„æ˜¯ï¼š',
                    'å·²çŸ¥ä¸€å…ƒä¸€æ¬¡æ–¹ç¨‹ 2x - 6 = 0ï¼Œæ±‚è§£xçš„å€¼å¹¶è¯´æ˜æ­¥éª¤ã€‚',
                    'åŒ–ç®€ï¼š2(x + 3) - (x - 1) = ï¼ˆã€€ã€€ï¼‰',
                    'ä¸‹åˆ—å“ªä¸ªæ˜¯æ–¹ç¨‹ 3x + 9 = 0 çš„è§£ï¼Ÿ',
                    'è¯·å†™å‡ºè§£é¢˜æ­¥éª¤å¹¶è®¡ç®—æœ€ç»ˆç»“æœã€‚'
                ],
                english: [
                    'What _____ your name?ï¼ˆå¡«å…¥æ­£ç¡®çš„beåŠ¨è¯ï¼‰',
                    'Choose the correct answer: This is _____ apple.',
                    'Translate: "è¿™æ˜¯æˆ‘çš„ä¹¦åŒ…" in English.',
                    'My name _____ Tom. ï¼ˆå¡«å…¥æ­£ç¡®çš„åŠ¨è¯ï¼‰',
                    'Which sentence is correct?',
                    'Please complete the sentence with the correct word.'
                ]
            };

            const questionList = sampleQuestions[subject] || sampleQuestions.chinese;
            const questionText = questionList[currentQuestion % questionList.length];
            
            // æ£€æµ‹æ˜¯å¦æ˜¯å¡«ç©ºé¢˜
            const isBlank = questionText.includes('ï¼ˆã€€ã€€ï¼‰') || questionText.includes('_____');
            
            return {
                type: isBlank ? 'å¡«ç©ºé¢˜' : types[currentQuestion % types.length],
                difficulty: difficulties[currentQuestion % difficulties.length],
                question: questionText,
                options: !isBlank && currentQuestion % 3 === 0 ? (
                    subject === 'math' ? [
                        'A. x = 1',
                        'B. x = 2',
                        'C. x = 3',
                        'D. x = 4'
                    ] : subject === 'english' ? [
                        'A. a',
                        'B. an',
                        'C. the',
                        'D. /'
                    ] : [
                        'A. é€‰é¡¹ä¸€ï¼šè¿™æ˜¯ç¬¬ä¸€ä¸ªé€‰é¡¹çš„å†…å®¹',
                        'B. é€‰é¡¹äºŒï¼šè¿™æ˜¯ç¬¬äºŒä¸ªé€‰é¡¹çš„å†…å®¹',
                        'C. é€‰é¡¹ä¸‰ï¼šè¿™æ˜¯ç¬¬ä¸‰ä¸ªé€‰é¡¹çš„å†…å®¹',
                        'D. é€‰é¡¹å››ï¼šè¿™æ˜¯ç¬¬å››ä¸ªé€‰é¡¹çš„å†…å®¹'
                    ]
                ) : null,
                isTextInput: isBlank || currentQuestion % 3 !== 0
            };
        }

        function getDifficultyText(difficulty) {
            const map = { basic: 'åŸºç¡€', medium: 'ä¸­ç­‰', advanced: 'æ‹“å±•' };
            return map[difficulty] || 'åŸºç¡€';
        }

        // æ¸²æŸ“é€‰é¡¹
        function renderOptions(questionData) {
            const container = document.getElementById('options-container');
            container.innerHTML = '';

            if (questionData.options) {
                // é€‰æ‹©é¢˜
                questionData.options.forEach((option, index) => {
                    const optionDiv = document.createElement('div');
                    optionDiv.className = `option-item ${answers[currentQuestion] === String.fromCharCode(65 + index) ? 'selected' : ''}`;
                    optionDiv.onclick = () => selectOption(String.fromCharCode(65 + index));
                    
                    optionDiv.innerHTML = `
                        <div class="option-radio ${answers[currentQuestion] === String.fromCharCode(65 + index) ? 'selected' : ''}"></div>
                        <div class="option-text">${option}</div>
                    `;
                    
                    container.appendChild(optionDiv);
                });
            } else if (questionData.type === 'å¡«ç©ºé¢˜') {
                // å¡«ç©ºé¢˜ - åœ¨é¢˜ç›®çš„æ‹¬å·å†…è¾“å…¥
                // æ¸…ç©ºå®¹å™¨ï¼Œå› ä¸ºå¡«ç©ºä¼šç›´æ¥åœ¨é¢˜ç›®ä¸­æ˜¾ç¤º
                container.innerHTML = '';
                // å¡«ç©ºé¢˜çš„è¾“å…¥ä¼šåœ¨é¢˜ç›®æ–‡æœ¬ä¸­å¤„ç†
            } else {
                // ç®€ç­”é¢˜ - ä½¿ç”¨å¤§æ–‡æœ¬æ¡†
                const textarea = document.createElement('textarea');
                textarea.className = 'text-input';
                textarea.placeholder = 'è¯·åœ¨æ­¤å¤„ä½œç­”ï¼Œè¯¦ç»†é˜è¿°ä½ çš„è§‚ç‚¹...';
                textarea.value = answers[currentQuestion] || '';
                textarea.oninput = () => {
                    answers[currentQuestion] = textarea.value;
                    renderQuestionNav();
                };
                container.appendChild(textarea);
            }
        }

        // é€‰æ‹©é€‰é¡¹
        function selectOption(option) {
            answers[currentQuestion] = option;
            renderCurrentQuestion();
        }

        // è·³è½¬åˆ°æŒ‡å®šé¢˜ç›®
        function goToQuestion(index) {
            currentQuestion = index;
            renderCurrentQuestion();
        }

        // ä¸Šä¸€é¢˜
        function prevQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                renderCurrentQuestion();
            }
        }

        // ä¸‹ä¸€é¢˜
        function nextQuestion() {
            if (currentQuestion < 24) {
                currentQuestion++;
                renderCurrentQuestion();
            }
        }

        // æ›´æ–°å¯¼èˆªæŒ‰é’®
        function updateNavigationButtons() {
            document.getElementById('prev-btn').disabled = currentQuestion === 0;
            
            const nextBtn = document.getElementById('next-btn');
            const submitBtn = document.getElementById('submit-btn');
            
            if (currentQuestion === 24) {
                nextBtn.style.display = 'none';
                submitBtn.style.display = 'block';
            } else {
                nextBtn.style.display = 'block';
                submitBtn.style.display = 'none';
            }
        }

        // å¼€å§‹è®¡æ—¶å™¨
        function startTimer() {
            const timerElement = document.getElementById('timer');
            
            const updateTimer = () => {
                const minutes = Math.floor(timeRemaining / 60);
                const seconds = timeRemaining % 60;
                timerElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                if (timeRemaining <= 0) {
                    submitExercise();
                    return;
                }
                
                timeRemaining--;
                setTimeout(updateTimer, 1000);
            };
            
            updateTimer();
        }

        // æäº¤ç»ƒä¹ 
        function submitExercise() {
            const answeredCount = answers.filter(a => a && a.trim()).length;
            
            if (answeredCount < 25) {
                if (!confirm(`æ‚¨è¿˜æœ‰ ${25 - answeredCount} é“é¢˜æœªä½œç­”ï¼Œç¡®å®šè¦æäº¤å—ï¼Ÿ`)) {
                    return;
                }
            }
            
            showMessage('æ­£åœ¨æäº¤ç­”æ¡ˆå¹¶è¿›è¡ŒAIæ‰¹æ”¹...', 'info');
            
            setTimeout(() => {
                const urlParams = new URLSearchParams(window.location.search);
                const subject = urlParams.get('subject') || 'chinese';
                const grade = urlParams.get('grade') || 'grade1';
                const course = urlParams.get('course') || '1';
                
                window.location.href = `exercise-result.html?subject=${subject}&grade=${grade}&course=${course}&score=${Math.floor(Math.random() * 20) + 80}`;
            }, 2000);
        }

        function showMessage(text, type = 'info') {
            const message = document.createElement('div');
            message.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%) translateY(-100px);
                padding: 15px 25px;
                border-radius: 8px;
                color: white;
                font-weight: 500;
                z-index: 1000;
                transition: transform 0.3s ease;
                ${type === 'success' ? 'background: #27ae60;' : 'background: #667eea;'}
            `;
            message.textContent = text;
            
            document.body.appendChild(message);
            
            setTimeout(() => {
                message.style.transform = 'translateX(-50%) translateY(0)';
            }, 100);
            
            setTimeout(() => {
                message.style.transform = 'translateX(-50%) translateY(-100px)';
                setTimeout(() => {
                    document.body.removeChild(message);
                }, 300);
            }, 3000);
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('load', initializePage);

        // é˜²æ­¢æ„å¤–å…³é—­é¡µé¢
        window.addEventListener('beforeunload', function(e) {
            const answeredCount = answers.filter(a => a && a.trim()).length;
            if (answeredCount > 0) {
                e.preventDefault();
                e.returnValue = '';
            }
        });
    </script>
</body>
</html>
